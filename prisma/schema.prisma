generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Employee {
  empId    Int     @id @default(autoincrement())
  empName  String?
  departed Boolean @default(false)

  attendances Attendance[]
  expirations Expiration[]
  policyAcknowledgments PolicyAcknowledgment[]
  assetAssignments AssetAssignment[]
  formResponses FormResponse[] @relation("Trainee")
  user        User?
}

model AssetCategory {
  id          Int      @id @default(autoincrement())
  name        String   // e.g., "Radio", "Firearm", "Vehicle"
  description String?
  
  assets      Asset[]
}

model Asset {
  id          Int      @id @default(autoincrement())
  name        String   // e.g., "Motorola APX 6000"
  serialNumber String? @unique
  assetTag    String?  @unique // Internal barcode/tag
  
  categoryId  Int
  category    AssetCategory @relation(fields: [categoryId], references: [id])
  
  status      String   @default("AVAILABLE") // AVAILABLE, ASSIGNED, MAINTENANCE, RETIRED, LOST
  condition   String   @default("GOOD")      // NEW, GOOD, FAIR, POOR, DAMAGED
  
  purchaseDate DateTime?
  cost         Float?
  
  assignments AssetAssignment[]
}

model AssetAssignment {
  id          Int      @id @default(autoincrement())
  assetId     Int
  employeeId  Int
  
  assignedAt  DateTime @default(now())
  returnedAt  DateTime?
  
  assignedByUserId Int? 
  
  notes       String?
  
  asset       Asset    @relation(fields: [assetId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [empId])
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String   @default("TRAINEE") // 'TRAINEE', 'FTO', 'ADMIN'
  employee  Employee? @relation(fields: [empId], references: [empId])
  empId     Int?     @unique
  authoredResponses FormResponse[]
}

model Training {
  TrainingID   Int     @id @default(autoincrement())
  TrainingName String?
  category     String? // CEU Bucket (e.g. "Medical", "Fire", "Law")
  filePath     String? // Path to syllabus or training materials

  attendances Attendance[]
  exclusions  CertificateTrainingExclusion[]
}

model Attendance {
  attendanceID    Int       @id @default(autoincrement())
  attendanceDate  DateTime?
  attendanceHealth Boolean?
  attendanceHours Float?
  attendanceNote  String? // Note: Access text fields can be long
  
  employeeID      Int
  trainingID      Int

  employee Employee @relation(fields: [employeeID], references: [empId])
  training Training @relation(fields: [trainingID], references: [TrainingID])
}

model Certificate {
  CertificateID   Int     @id @default(autoincrement())
  certificateName String?
  neededHours     Float?
  yearsValid      Float?
  filePath        String? // Path to uploaded certificate template or reference

  exclusions  CertificateTrainingExclusion[]
  expirations Expiration[]
}

model Policy {
  id          Int      @id @default(autoincrement())
  title       String
  content     String
  version     String   @default("1.0")
  createdAt   DateTime @default(now())
  
  acknowledgments PolicyAcknowledgment[]
}

model PolicyAcknowledgment {
  id          Int      @id @default(autoincrement())
  policyId    Int
  employeeId  Int
  acknowledgedAt DateTime @default(now())

  policy      Policy   @relation(fields: [policyId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [empId])

  @@unique([policyId, employeeId])
}

model CertificateTrainingExclusion {
  exclusionID   Int @id @default(autoincrement()) // Synthetic ID as Access likely used composite key or no key
  certificateID Int
  trainingID    Int

  certificate Certificate @relation(fields: [certificateID], references: [CertificateID])
  training    Training    @relation(fields: [trainingID], references: [TrainingID])

  @@unique([certificateID, trainingID])
}

model Expiration {
  expirationID Int       @id @default(autoincrement()) // Synthetic ID
  CertificateID Int
  EmployeeID    Int
  Expiration    DateTime?
  documentPath  String?

  certificate Certificate @relation(fields: [CertificateID], references: [CertificateID])
  employee    Employee    @relation(fields: [EmployeeID], references: [empId])
}

model FormTemplate {
  id          Int      @id @default(autoincrement())
  title       String
  version     Int      @default(1)
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  sections    FormSection[]
  responses   FormResponse[]
}

model FormSection {
  id          Int      @id @default(autoincrement())
  title       String
  order       Int
  
  templateId  Int
  template    FormTemplate @relation(fields: [templateId], references: [id])
  
  fields      FormField[]
}

model FormField {
  id          Int      @id @default(autoincrement())
  label       String
  type        String   // "RATING", "TEXT", "BOOLEAN"
  order       Int
  required    Boolean  @default(true)
  
  sectionId   Int
  section     FormSection @relation(fields: [sectionId], references: [id])
}

model FormResponse {
  id          Int      @id @default(autoincrement())
  date        DateTime @default(now())
  
  traineeId   Int
  trainee     Employee @relation("Trainee", fields: [traineeId], references: [empId])
  
  ftoId       Int
  fto         User     @relation(fields: [ftoId], references: [id]) 

  templateId  Int
  template    FormTemplate @relation(fields: [templateId], references: [id])
  
  responseData String // JSON string storing { fieldId: value }
  
  status      String   @default("DRAFT") // DRAFT, SUBMITTED, REVIEWED
}
